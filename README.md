# azure-webapp-dnstest

### Description of the issue

DNS resolution is not working in Web App for Containers (linux) when using an alpine linux based custom docker image. The DHCP generated resolv.conf is broken. After using SSH to log in to the container trying nslookup google.com also fails with DNS resolution error.

### Dockerhub
https://hub.docker.com/r/henrikschnell/azure-webapp-dnstest/

### Run custom docker image as web app
https://docs.microsoft.com/en-us/azure/app-service/containers/tutorial-custom-docker-image

### Run on azure:
```
# create resource group
az group create -l westeurope -n dnstest

# create app service plan
az appservice plan create -n dnstest-webapp-plan -g dnstest --is-linux

# create web app from docker image
az webapp create -n dnstest -p dnstest-webapp-plan -g dnstest -i henrikschnell/azure-webapp-dnstest
```

### Open
http://dnstest.azurewebsites.net/

### Sample output in Azure

```
Azure App Service - Web App for Containers
[DNS TEST] connection error: {"code":"EAI_AGAIN","errno":"EAI_AGAIN","syscall":"getaddrinfo","hostname":"google.com","host":"google.com","port":80}

etc/resolv.conf:
search reddog.microsoft.com
nameserver 127.0.0.11
options timeout:1 attempts:5 ndots:0
```

### Run locally:
```
docker run -p 8080:80 --name dnstest henrikschnell/azure-webapp-dnstest
```


### Sample output on localhost

```
Azure App Service - Web App for Containers
[DNS TEST] connected to server: google.com

/etc/resolv.conf:
# Generated by dhcpcd from eth0.dhcp
# /etc/resolv.conf.head can replace this line
nameserver 192.168.65.1
# /etc/resolv.conf.tail can replace this line
```
